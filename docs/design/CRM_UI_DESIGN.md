# 個人院向けミニCRM UI/Host設計書 (v1.0)

## 1. プロジェクト概要
### コンセプト
**「横に置く、第2の脳」**
一人院長が患者との信頼関係（ラポール）を深めるために、患者の背景や過去の反応を「瞬時に」思い出すための補助ツール。レセコンのような事務処理ツールではなく、**「対話のためのノート」**を目指す。

### 想定ユーザー
- **ユーザー**: 1人で診療を行う整体院・鍼灸院・クリニックの院長。
- **利用環境**: 問診デスクや施術室のサイドテーブルにあるノートPC（横幅 1280px ~ 1440px 想定）。
- **ITリテラシー**: ブラウザ操作は問題ないが、複雑な設定は好まない。

---

## 2. 機能スコープ (MVPフェーズ)
**目標**: 「これがあれば、紙のノートやEXCEL管理から移行できる」最小セット。

### ✅ 実装機能 (Must)
1.  **患者管理**: 基本情報の登録・編集・一覧・検索。
2.  **施術記録**: 来院ごとの症状・施術・メモの時系列記録。
3.  **瞬時の振り返りUI**: 患者詳細画面で、過去の履歴をスクロールだけで確認できること。
4.  **グローバル検索**: どの画面からでも即座に患者を呼び出せる検索窓。
5.  **データ永続化**: ローカルDB (SQLite) への保存。

### ❌ 今回やらない (Out of Scope)
- ログイン/認証（ローカル利用前提のため、v1では省略またはモック）
- 画像アップロード（MVPではテキストのみ）
- 予約カレンダー機能
- 請求・会計機能
- スマホ・タブレット専用レイアウト（PCレイアウトが崩れない程度に対応）

---

## 3. アプリケーション構成

### 技術スタック
- **Framework**: Next.js (App Router)
- **Styling**: Vanilla CSS (CSS Modules) - 独自の世界観（柔らかさ・落ち着き）を表現するため。
- **Database**: SQLite (+Prisma)

### 画面レイアウト (Global Layout)
- **常に表示**: ヘッダー（またはサイドバー）
    - **グローバル検索窓**: `Cmd+K` または常時表示で、氏名・カナ検索が可能。
    - **新規登録ボタン**: どこからでも新患登録へ。
    - **ホームアイコン**: ダッシュボードへ戻る。

---

## 4. ルーティング & 画面遷移詳細

| URL | 画面名 | 役割・UI形状 |
| :--- | :--- | :--- |
| `/` | **Dashboard** | 今日の来院予定（MVPでは直近更新患者リスト）、クイックアクセス。 |
| `/patients` | **Patient List** | 詳細検索、全件リスト。 |
| `/patients/new` | **New Patient** | 新規登録フォーム（またはモーダル）。 |
| `/patients/[id]` | **Patient Detail** | **[Core]** 患者情報の閲覧・履歴表示。 |
| `/patients/[id]/edit` | **Edit Patient** | 基本情報の修正。 |
| `/patients/[id]/records/new` | **New Record** | 施術記録入力。※UX向上のため詳細画面上のモーダル推奨。 |
| `/records/[id]/edit` | **Edit Record** | 過去の記録の修正。 |

---

## 5. 詳細画面仕様 (UI Specs)

### A. Dashboard (`/`)
- **目的**: アプリを開いて「さあ、始めよう」となる起点。
- **コンテンツ**:
    - 「最近の患者」リスト（最終更新順 5件）
    - 「新規患者登録」の大きなカード/ボタン
    - （Future: 今日の来院予定リスト）

### B. Patient Detail (`/patients/[id]`)
**このアプリの最重要画面。**
画面を左右（または上下）に分割し、**「人物像」と「時系列」を同時に見る**ことができる。

**① Left/Top Panel: パーソナル情報 (固定)**
- 顔写真(placeholder) + 氏名 + 年齢 + 性別
- **重要タグ**: 「紹介」「要注意」「VIP」など
- **主訴 (Chief Complaint)**: 一番の悩み。常に目に入る場所に。
- **ラポールメモ**:
    - 職業、家族構成、趣味、話し方の特徴など。
    - 「前回話した雑談」などをメモする場所。

**② Right/Bottom Panel: 施術タイムライン (スクロール)**
- 最新の記録が一番上。
- **記録カード**:
    - 日付・経過日数（「2週間ぶり」など自動計算）
    - **S (訴え)**: その日の調子。
    - **O/A (施術)**: 何をしたか、反応はどうだったか。
    - **P (次回)**: 申し送り事項。

### C. New Record Input
- 入力負荷を下げるため、項目はシンプルに。
- **場所**: 別ページ遷移ではなく、詳細画面の上に重なる **モーダル** または **スライドパネル** を推奨（文脈を維持するため）。
- **項目**:
    - 来院日時 (初期値: 現在)
    - **Main Symptoms (訴え)** [Textarea / 4行〜]
    - **Treatment / Menu (施術)** [Textarea / 4行〜]
    - **Private Note (院長メモ)** [Textarea / 2行〜]
    - **Plan (次回への引き継ぎ)** [Tnput / 1行]

---

## 6. データモデル概要 (Frontend View)

### Patient (患者)
- `id`: string
- `name`: string (漢字)
- `kana`: string (ふりがな) - 検索用
- `birthDate`: string? (年齢計算用)
- `phone`: string?
- `note`: string (ラポールメモ・基本情報)
- `tags`: string[] (属性タグ)
- `lastVisit`: datetime (一覧ソート用)

### ClinicalRecord (施術記録)
- `id`: string
- `patientId`: string
- `visitDate`: datetime
- `symptoms`: string (S)
- `treatments`: string (O/A)
- `privateNote`: string (所感・メモ)
- `nextPlan`: string (P)
- `createdAt`: datetime

---

## 7. 開発優先ステップ
1.  **Layout & Routing基盤**: ヘッダー、検索窓の実装。
2.  **Patient CRUD**: 患者登録と詳細表示（静的データでUI確認）。
3.  **Record Display**: 詳細画面のタイムラインUI構築（ここがUXの勝負）。
4.  **Record Input**: モーダルでの入力フォーム実装。
5.  **DB Binding**: SQLiteへの接続。
