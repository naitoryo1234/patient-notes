# AIテキストインポート構想 (Future Feature Idea)

## 1. ワークフロー概要
先生がAI（Gemini等）を活用して画像からテキスト化したデータを、CRMのテキストエリアに貼り付けることで、手軽に患者登録・記録保存を行えるようにする機能。

### 想定フロー
1.  **先生の作業**:
    - 紙カルテを撮影し、Geminiに投げる。
    - Geminiが指定フォーマットでテキストを出力する。
    - 先生がそのテキストをコピーする。
2.  **CRMでの作業**:
    - CRMの「AIインポート」画面を開く。
    - テキストエリアにペーストして「解析」ボタンを押す。
    - 画面左に元テキスト、右に解析結果が入ったフォームが表示される。
    - 内容を確認修正し、「登録」ボタンでDB保存。

## 2. インポート用テキストフォーマット案 (v1)
シンプルで、人間が読んでもAIが生成しても間違いにくいキーバリュー形式を採用。

```text
[基本情報]
氏名: 山田 太郎
カナ: ヤマダ タロウ
生年月日: 1980-05-01
性別: 男性
電話番号: 090-1234-5678
初回フラグ: はい

[施術記録]
来院日: 2024-12-10
S(主訴): 朝起きたときに左腰に激痛。前屈できない。
O(所見): 左L4/L5周辺に圧痛あり。SLRテスト右45度で陰性、左30度で陽性。
A(施術): 鍼パルス(L4-S1)、殿筋マッサージ。
P(計画): 急性期のためアイシング指導。次回3日後。
```

## 3. UI/UX コンセプト

### 画面レイアウト: Split View
- **Left Pane (Source)**:
  - 大きなテキストエリア。
  - 貼り付けられたテキストをそのまま表示。
- **Right Pane (Preview & Edit)**:
  - 通常の患者登録/記録入力フォームと同じコンポーネントを流用。
  - 解析できた項目は埋められ、できなかった項目は空欄（または「不明」）となる。
  - 必須項目が欠けている場合はバリデーションエラーを表示。

### 安全策 (Safety)
- **「即時保存」はしない**: 必ず人間が「登録」ボタンを押すまでDBには書き込まない。
- **既存患者チェック**: 氏名・カナ・生年月日等から既存患者を検索し、「新規登録」か「既存患者への追記」かをユーザーに選択させる。

## 4. 実装への影響 (v3.0 System Designへの反映)

この機能を将来実装しやすくするため、既存設計に以下の要素が必要であることを確認した（v3.0で既に考慮済みだが、念のため強調）。

1.  **Parse Logicの分離**:
    - テキスト解析ロジックはUIから独立した `services/importService.ts` に置くべき。
2.  **Formの再利用性**:
    - 通常の登録画面と、このプレビュー画面で、同じフォームコンポーネント(`src/components/form/RecordForm.tsx` 等)を使い回せるようにする。
    - フォームには `initialValues` をPropsで渡せる設計にする必要がある。
