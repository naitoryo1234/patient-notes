# 配布・展開戦略 (Distribution Strategy)

本プロジェクトでは、顧客のITリテラシーや運用体制に合わせて選択可能な**ハイブリッド配布戦略**を採用します。

---

## 🚀 戦略の概要 (Overview)

| 方式 | A. SaaS型 (Vercel) | B. デスクトップアプリ型 (Electron) |
|:---|:---|:---|
| **対象顧客** | ITに不慣れで「面倒を見てほしい」層、または複数名で同時アクセスしたい医院 | コスト意識が高く、データの自己管理を望む個人事業主 |
| **データ保管** | クラウド (Vercel Postgres / Neon) | ローカルPC内 (SQLite) |
| **起動方法** | ブラウザでURLにアクセス | デスクトップアイコンをダブルクリック |
| **課金モデル** | 月額サポート費 + サーバー実費 | 初期ライセンス費 + 任意サポート |
| **責任範囲** | 開発者が可用性を担保 (SLA) | ソフトウェア品質のみ担保 (PC管理は顧客) |

---

## 🛠️ A. SaaS型配布 (Cloud / Vercel)

標準的なWebアプリケーションとしてVercel等のPaaSにデプロイし、顧客にURLを提供します。

### メリット
- **即時利用可能**: インストール不要、URL共有のみで開始。
- **マルチデバイス**: PC、タブレット、スマホから同時アクセス可能。
- **データ保全**: クラウド管理され、PC故障時もデータは無事。

### デメリット
- **ランニングコスト**: サーバー代（またはProプラン費）がかかる。
- **サービス停止リスク**: VercelやDBプロバイダの障害・仕様変更の影響を受ける。
- **ネット必須**: インターネット環境がないと使えない。

### 技術要件
- 環境変数 (`.env`) で機能フラグを管理。
- 認証機能 (`AUTH_ENABLED=true`) が必須。

---

## 💻 B. デスクトップアプリ型配布 (Local / Electron)

Next.jsアプリケーションをElectronでラップし、インストーラー（.exe / .dmg）として配布します。

### メリット
- **「アプリ」としての親しみ**: ブラウザのタブに埋もれず、独立したウィンドウで動作。
- **完全ローカル**: ネット不要、サーバー代ゼロ。
- **責任の分離**: 「ハードウェア故障は顧客責任」と明確に切り分けやすい。

### デメリット
- **バックアップ**: 顧客が自分でバックアップを取る必要がある（機能サポート必須）。
- **複数端末NG**: 基本的にインストールしたPC1台でのみ動作（SQLite制約）。

### 技術要件
- **動的な機能切替**: 環境変数を再ビルドなしで変更できないため、**設定画面（UI）からの機能ON/OFF**が必要。
- **自動バックアップ**: 終了時などにデータを退避する仕組みが必要。

---

## 📝 開発ロードマップへの影響

このハイブリッド戦略を支えるため、コードベースは以下の原則に従います。

1. **環境変数とDB設定の併用**:
   - `src/config/features.ts` を修正し、環境変数は「デフォルト値」として扱い、DB内の `SystemSetting` テーブルが優先されるアーキテクチャにする。
2. **ストレージの抽象化**:
   - 画像保存先などは「ローカルファイルシステム」と「Vercel Blob / S3」を切り替えられる設計（またはインターフェース）を維持する。

---

*最終更新: 2025-12-13*
