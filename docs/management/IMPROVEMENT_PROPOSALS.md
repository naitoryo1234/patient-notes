# ページ別改善提案・機能詳細化 (Phase 9 Polish)

システム全体の完成度を高めるため、ページ単位でUI/UXおよび機能の深掘りを行います。
以下のリストに基づき、各ページを「完了」状態まで仕上げていきます。

---

## 1.  患者詳細ページ (`/patients/[id]`) [Polish完了]

最も情報量が多く、運用の要となるページです。

### 1-1. プロフィール・基本情報
- [x] **タグの視認性向上**:
    - 実装済み: `PatientCard.tsx` 等で特定のタグ（重要、禁忌など）に対して色分けロジックを適用済み。
- [ ] **メモの表示最適化**:
    - 現状: 全文表示（長文だと圧迫する可能性）。
    - 提案: 3行程度で省略表示し、「もっと見る」で展開するようにしてレイアウト崩れを防ぐ。
- [ ] **スマホ対応（レスポンシブ）**:
    - 提案: モバイル閲覧時に、サイドバー（プロフィール）がメインコンテンツの上に配置されるか、タブ切り替えにするなどのレイアウト調整が必要か確認。

### 1-2. 施術履歴 (Clinical Records)
- [ ] **履歴の編集・削除**:
    - 現状: 作成後の修正フローが未整備の可能性あり。要仕様確認。
- [x] **担当者表示**:
    - 実装済み: リスト上で担当者名を表示。

### 1-3. 次回予約UI (Next Appointment)
- [x] **編集・削除への導線**: 実装完了（モーダル編集＋台帳誘導）。
- [x] **入力UI**: 実装完了（5分刻みセレクトボックス）。

---

## 2.  予約台帳ページ (`/appointments`) [Next Focus]

予約の全体像を把握し、調整する司令塔となるページです。ここが次の改善ターゲットです。

### 2-1. 安全性・整合性 (Must)
- [x] **患者DB（ダブルブッキング）防止**:
    - 実装済み: サーバーサイドで厳密な重複チェックを導入済み。
- [ ] **過去日予約の警告**:
    - 提案: 過去の日付に予約を入れる際、警告モーダルまたは確認ダイアログを挟む。

### 2-2. 閲覧性・操作性
- [ ] **キャンセル済み予約のフィルタリング**:
    - 提案: 「キャンセルを表示/非表示」トグルを追加し、画面をスッキリさせる。
- [ ] **時間軸の表示最適化**:
    - 提案: 早朝・深夜など診療時間外のスクロールを減らすため、初期スクロール位置を「現在の時間」または「開院時間」に合わせる。

---

## 3.  ダッシュボード / トップページ (`/`) [Current Focus]

アプリの入り口であり、受付業務のメイン画面です。「本日の予定」の見やすさが最優先です。

### 3-1. 検索機能の強化
- [x] **診察券番号 (No.) 検索**:
    - 実装済み。
- [x] **スマート・ディレクトリ化 (右カラム)**:
    - リスト表示を廃止し、タブ構成（履歴/検索/要確認）に変更。
    - 通常時は履歴、異常時はAttentionを表示することで、運用をナビゲートする役割を付与。

### 3-2. 本日の予定パネル
- [x] **自動更新 (Auto-Refresh)**:
    - 実装済み: 1分ごとのポーリング。
- [x] **来院チェックイン (Check-in)**:
    - 実装済み: 楽観的UI更新を導入し、即時反応するように改善。
- [x] **未割り当て予約の強調**:
    - 実装済み: 右カラムの「要確認」タブに集約。
- [x] **来院済み患者の分離**:
    - 実装済み: 「これからの予約」を上部に、「完了・キャンセル」を下部に分離して表示。

---

## 4. ⚙️ 設定・その他

- [ ] **スタッフ1人運用モード**:
    - 提案: スタッフ選択の手間を省くための設定。
- [ ] **Global Loading UI**:
    - 提案: 画面遷移時や処理待ち時に、ユーザーを不安にさせないためのローディング表示の統一。

---
**進行ルール**:
1つのセクション（ページ）のタスクを全て消化・また見送りを決定してから、次のセクションへ進む。
