# ページ別改善提案・機能詳細化 (Phase 9 Polish)

システム全体の完成度を高めるため、ページ単位でUI/UXおよび機能の深掘りを行います。
以下のリストに基づき、各ページを「完了」状態まで仕上げていきます。

---

## 1.  患者詳細ページ (`/patients/[id]`) [Polish完了]

最も情報量が多く、運用の要となるページです。

### 1-1. プロフィール・基本情報
- [x] **タグの視認性向上**:
    - 実装済み: `PatientCard.tsx` 等で特定のタグ（重要、禁忌など）に対して色分けロジックを適用済み。
- [ ] **メモの表示最適化**:
    - 現状: 全文表示（長文だと圧迫する可能性）。
    - 提案: 3行程度で省略表示し、「もっと見る」で展開するようにしてレイアウト崩れを防ぐ。
- [ ] **スマホ対応（レスポンシブ）**:
    - 提案: モバイル閲覧時に、サイドバー（プロフィール）がメインコンテンツの上に配置されるか、タブ切り替えにするなどのレイアウト調整が必要か確認。

### 1-2. 施術履歴 (Clinical Records)
- [ ] **履歴の編集・削除**:
    - 現状: 作成後の修正フローが未整備の可能性あり。要仕様確認。
- [x] **担当者表示**:
    - 実装済み: リスト上で担当者名を表示。

### 1-3. 次回予約UI (Next Appointment)
- [x] **編集・削除への導線**: 実装完了（モーダル編集＋台帳誘導）。
- [x] **入力UI**: 実装完了（5分刻みセレクトボックス）。

---

## 2.  予約台帳ページ (`/appointments`) [Next Focus]

予約の全体像を把握し、調整する司令塔となるページです。ここが次の改善ターゲットです。

### 2-1. 安全性・整合性 (Must)
- [x] **患者DB（ダブルブッキング）防止**:
    - 実装済み: サーバーサイドで厳密な重複チェックを導入済み。
- [ ] **過去日予約の警告**:
    - 提案: 過去の日付に予約を入れる際、警告モーダルまたは確認ダイアログを挟む。

### 2-2. 閲覧性・操作性
- [ ] **キャンセル済み予約のフィルタリング**:
    - 提案: 「キャンセルを表示/非表示」トグルを追加し、画面をスッキリさせる。
- [ ] **時間軸の表示最適化**:
    - 提案: 早朝・深夜など診療時間外のスクロールを減らすため、初期スクロール位置を「現在の時間」または「開院時間」に合わせる。

---

## 3.  ダッシュボード / トップページ (`/`) [Current Focus]

アプリの入り口であり、受付業務のメイン画面です。「本日の予定」の見やすさが最優先です。

### 3-1. 検索機能の強化
- [x] **診察券番号 (No.) 検索**:
    - 実装済み。
- [x] **スマート・ディレクトリ化 (右カラム)**:
    - リスト表示を廃止し、タブ構成（履歴/検索/要確認）に変更。
    - 通常時は履歴、異常時はAttentionを表示することで、運用をナビゲートする役割を付与。

### 3-2. 本日の予定パネル
- [x] **自動更新 (Auto-Refresh)**:
    - 実装済み: 1分ごとのポーリング。
- [x] **来院チェックイン (Check-in)**:
    - 実装済み: 楽観的UI更新を導入し、即時反応するように改善。
- [x] **未割り当て予約の強調**:
    - 実装済み: 右カラムの「要確認」タブに集約。
- [x] **来院済み患者の分離**:
    - 実装済み: 「これからの予約」を上部に、「完了・キャンセル」を下部に分離して表示。

---

## 4. ⚙️ 設定・その他

- [ ] **スタッフ1人運用モード**:
    - 提案: スタッフ選択の手間を省くための設定。
- [ ] **Global Loading UI**:
    - 提案: 画面遷移時や処理待ち時に、ユーザーを不安にさせないためのローディング表示の統一。

---
**進行ルール**:
1つのセクション（ページ）のタスクを全て消化・また見送りを決定してから、次のセクションへ進む。

---

## 5. 📊 デモ版自己評価からの改善提案 (2025-12-12)

Vercel デモ版のレビューに基づく改善提案。v1.2 以降の開発ロードマップに組み込む候補。

### 5-1. 機能性の改善

| 優先度 | 改善点 | 現状 | 理想 |
|--------|--------|------|------|
| ⭐⭐⭐ | **予約カレンダービュー** | リスト表示のみ | 週/月カレンダー表示で空き確認しやすく |
| ⭐⭐⭐ | **繰り返し予約** | 毎回手動で作成 | 「毎週火曜14時」のような定期予約 |
| ⭐⭐ | **検索の強化** | 患者名のみ | 日付範囲、症状、担当者での絞り込み |
| ⭐ | **患者統合** | 重複患者の統合機能なし | 同一患者の名寄せ・統合 |
| ⭐ | **カルテ印刷** | 印刷ビューなし | 紙カルテ用の印刷レイアウト |

### 5-2. UI/UX の改善

| 優先度 | 改善点 | 現状 | 理想 |
|--------|--------|------|------|
| ⭐⭐⭐ | **モバイル最適化** | 基本対応 | タッチ操作に最適化したUI |
| ⭐⭐ | **空状態のデザイン** | 「データなし」テキストのみ | イラスト付きの説明とアクションボタン |
| ⭐⭐ | **ローディング表示** | 部分的 | スケルトンローダーで統一感 |
| ⭐ | **キーボードショートカット** | なし | `Ctrl+N` で新規患者など |
| ⭐ | **元に戻す機能** | 削除は取り消し不可 | Undo/Redo 機能 |
| ⭐ | **ダークモード** | なし | 目に優しい暗いテーマ |

### 5-3. 実装優先度（推奨順序）

1. **予約カレンダービュー** - 実装完了 (v1.1)
2. **繰り返し予約** - 定期患者の予約を効率化
3. **モバイル最適化** - 施術中にスマホで確認できる
4. **空状態のデザイン** - 初回ユーザー体験向上
5. **検索の強化** - 患者数が増えた際に必要

---

## 6. 📅 カレンダービュー改善 (v1.2+ Scalability)

v1.1で実装されたカレンダービューを、予約数やスタッフ数が増加した際の実務運用に耐えうる形へ進化させるための課題。

### 6-1. 週表示の視認性向上（スタッフ別カラム）
- **現状**: 時間軸のみで、複数スタッフの予約が重なると視認性が低下する恐れがある。
- **提案**: **バーチカル（列）表示**を導入し、「時間 × スタッフ」のマトリックス表示、または「スタッフ別カラム」切り替え機能を検討。
    - *難易度: 高 (UIライブラリの選定が必要になる可能性)*

### 6-2. 月表示の「もっと見る」対応
- **現状**: セル内でスクロール可能だが、件数が多いと一覧性が低い。
- **提案**: 1日の表示件数を3件程度に制限し、超過分は「+N件」としてポップオーバーやドロワーで詳細を表示する。

### 6-3. フィルタリング機能
- **現状**: 全スタッフの予約が表示される。
- **提案**: 「特定のスタッフのみ表示」「自分の予約のみ表示」などのフィルタリング機能を追加し、情報量を制御できるようにする。
