# 🧪 動作確認手順書: 予約管理 (Appointment Management)

## 📌 概要
本ドキュメントは、予約管理機能（`/appointments`）の動作確認手順と期待される挙動を定義します。
カレンダービューのテストは `TEST_PLAN_CALENDAR.md` を参照してください。

---

## 1. 予約作成 (Create)

### 1-1. 新規作成
| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-01 | **モーダル表示** | 予約一覧の「新規作成」ボタンをクリックする。 | ・予約作成モーダルが開く。<br>・患者選択、日時、所要時間、担当者、メモ欄が表示される。 |
| AP-02 | **患者選択** | モーダル内の患者検索で患者を選択する。 | ・選択した患者名がフォームに表示される。 |
| AP-03 | **日時選択** | 日付ピッカーと時間選択で日時を設定する。 | ・選択した日時がフォームに反映される。 |
| AP-04 | **所要時間選択** | 所要時間を30分/60分/90分から選択する。 | ・選択した所要時間が保存される。 |
| AP-05 | **担当者任意** | 担当者を選択せずに保存する。 | ・保存が成功する（担当者は任意）。<br>・一覧で「担当未定」として警告表示される。 |
| AP-06 | **正常保存** | 全項目を入力して保存ボタンをクリックする。 | ・保存成功メッセージが表示される。<br>・一覧に新しい予約が表示される。 |

### 1-2. 予約コピー（複製）
| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-07 | **コピー作成** | 既存予約のメニューから「コピーして作成」を選択する。 | ・患者、担当者、メモがプリフィルされた新規作成モーダルが開く。<br>・日時は空欄または現在日時。 |

---

## 2. 予約編集 (Update)

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-08 | **編集モーダル** | 予約一覧またはカレンダーで予約をクリックし、「編集」ボタンを押す。 | ・編集モーダルが開く。<br>・既存データがプリフィルされている。 |
| AP-09 | **日時変更** | 予約の開始時間を変更して保存する。 | ・変更が反映され、一覧・カレンダーで新しい時間に表示される。 |
| AP-10 | **担当者変更** | 担当者を別のスタッフに変更して保存する。 | ・変更が反映される。<br>・変更先スタッフの予約枠に問題がないかチェックされる。 |

---

## 3. 予約キャンセル

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-11 | **キャンセル実行** | 予約詳細から「キャンセル」ボタンをクリックする。 | ・確認ダイアログが表示される。 |
| AP-12 | **キャンセル確定** | 確認ダイアログで「はい」をクリックする。 | ・ステータスが `cancelled` に変更される。<br>・一覧で打ち消し線や色変更で表示される。 |
| AP-13 | **キャンセル済み表示** | キャンセル済みの予約を一覧で確認する。 | ・視覚的に区別できる（グレーアウト、打ち消し線など）。 |

---

## 4. 重複チェックロジック

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-14 | **同一担当者重複** | 同じ担当者で同じ時間帯に2件目の予約を作成しようとする。 | ・エラーメッセージが表示される。<br>・「このスタッフは既に予約があります」等の警告。 |
| AP-15 | **異なる担当者許可** | 異なる担当者で同じ時間帯に予約を作成する。 | ・保存が成功する（担当者が異なれば重複OK）。 |
| AP-16 | **時間帯重複チェック** | 10:00-11:00の予約がある状態で、10:30-11:30の予約を作成しようとする（同一担当者）。 | ・重複としてエラーになる（部分的な重なりも検知）。 |
| AP-17 | **担当なし同士** | 担当者未定の予約が既にある時間帯に、担当者未定で予約を作成する。 | ・保存が成功する（担当者未定は重複チェック対象外）。 |

---

## 5. 申し送り機能 (Admin Memo)

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-18 | **申し送り入力** | 予約作成/編集時に「申し送り」欄にテキストを入力して保存する。 | ・申し送りが保存される。<br>・一覧・カレンダーで⚠️アイコンが表示される。 |
| AP-19 | **確認済みトグル** | 未確認の申し送りがある予約で「確認済み」ボタンをクリックする。 | ・`isMemoResolved` が `true` に変更される。<br>・解決者ID・日時が記録される。<br>・⚠️アイコンが消える（またはチェックマークに変わる）。 |
| AP-20 | **アラート表示** | 未確認の申し送りがある状態でダッシュボード・予約一覧を確認する。 | ・赤色のアラートバナーが表示される。<br>・ダッシュボード：「本日の未確認申し送り: X件」<br>・予約一覧：「すべての未確認申し送り: X件」 |

---

## 6. 一覧画面のフィルタリング

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-21 | **日付フィルタ** | 日付ピッカーで特定の日付を選択する。 | ・選択した日付の予約のみが表示される。 |
| AP-22 | **ステータスフィルタ** | ステータスドロップダウンで「キャンセル済み」を選択する。 | ・キャンセル済みの予約のみが表示される。 |
| AP-23 | **担当者フィルタ** | 担当者ドロップダウンで特定のスタッフを選択する。 | ・選択したスタッフ担当の予約のみが表示される。 |
| AP-24 | **過去予約表示** | 「過去の予約を含む」トグルをONにする。 | ・過去日付の予約も一覧に表示される（台帳モード）。 |

---

## 7. ページネーション

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| AP-25 | **ページ切り替え** | 予約が多数（例：50件以上）存在する状態でページネーションを操作する。 | ・次ページ/前ページに正しく遷移する。<br>・表示件数が1ページあたりの設定通りになっている。 |
| AP-26 | **ツールバー配置** | ページネーションの位置を確認する。 | ・ツールバー（画面上部）に配置されている。 |

---

## ✅ テスト実施記録

| ID | 結果 | 実施日時 | 実施者 | 備考 |
|:---|:---:|:---|:---|:---|
| AP-01 | ✅ | 2025-12-15 12:00 | System | Browser Automation |
| AP-02 | ✅ | 2025-12-15 12:00 | System | Browser Automation (Covered by AP-06) |
| AP-03 | ✅ | 2025-12-15 12:00 | System | Browser Automation (Covered by AP-06) |
| AP-04 | ✅ | 2025-12-15 12:00 | System | Browser Automation (Covered by AP-06) |
| AP-05 | ⬜ | - | - | - |
| AP-06 | ✅ | 2025-12-15 12:00 | System | Browser Automation |
| AP-07 | ⬜ | - | - | - |
| AP-08 | ✅ | 2025-12-15 12:40 | System | Browser Automation (Success) |
| AP-09 | ✅ | 2025-12-15 12:40 | System | Browser Automation (Covered by Update) |
| AP-10 | ⬜ | - | - | - |
| AP-11 | ✅ | 2025-12-15 13:00 | System | Browser Automation (List View) |
| AP-12 | ✅ | 2025-12-15 13:00 | System | Browser Automation (Covered by Cancel) |
| AP-13 | ⬜ | - | - | - |
| AP-14 | ✅ | 2025-12-15 12:40 | System | Browser Automation (Creation Prevented) |
| AP-15 | ⬜ | - | - | - |
| AP-16 | ✅ | 2025-12-15 12:40 | System | Browser Automation (Creation Prevented) |
| AP-17 | ⬜ | - | - | - |
| AP-18 | ✅ | 2025-12-15 12:55 | System | Browser Automation |
| AP-19 | ✅ | 2025-12-15 13:00 | System | Browser Automation |
| AP-20 | ⬜ | - | - | - |
| AP-21 | ⬜ | - | - | - |
| AP-22 | ⬜ | - | - | - |
| AP-23 | ⬜ | - | - | - |
| AP-24 | ⬜ | - | - | - |
| AP-25 | ⬜ | - | - | - |
| AP-26 | ⬜ | - | - | - |

**凡例**: ✅ = 通過 / ❌ = 失敗 / ⬜ = 未実施

