# 🧪 動作確認手順書: カレンダー (Calendar)

## 📌 概要
本ドキュメントは、カレンダービュー機能（`/appointments` のカレンダーモード）の動作確認手順と期待される挙動を定義します。

---

## 1. カレンダー表示・操作

### 1-1. 週表示 (Week View)
| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| C-01 | **予約の基本表示** | 任意の週を表示する。<br>予約データが存在すること。 | ・指定した日時の枠に予約カードが表示される。<br>・開始時間、患者名が表示される。 |
| C-02 | **重複予約の表示** | 同一日時(例: 10:00)に2件の予約が存在する場合。 | ・予約カードが重ならず、横並び（列分割）で表示される。<br>・双方のカードがクリック・ホバー可能である。 |
| C-03 | **担当者色分け** | 担当者が設定されている予約と、未設定の予約を表示する。 | ・担当者ごとに左ボーダーの色が異なる。<br>・未設定または担当なしの場合は指定の警告色（赤系など）またはデフォルト色である。 |
| C-04 | **ツールチップ** | 予約カードにマウスカーソルを合わせる。 | ・ツールチップが表示される。<br>・**患者名（フリガナ）**が最上部に表示される。<br>・申し送りがある場合「⚠️」付きで表示される。<br>・メモがある場合「📝」付きで表示される。 |
| C-05 | **スクロール** | 1日の予約が多い場合、カレンダーを縦にスクロールする。 | ・ヘッダー（曜日行）が固定され、グリッド部分のみがスクロールする。 |

### 1-2. ドラッグ＆ドロップ (DnD)
| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| C-06 | **予約の移動** | 予約カードをドラッグし、別の時間枠（空き）にドロップする。 | ・予約が即座に新しい時間枠に移動する。<br>・DB更新が成功し、リロードしても位置が維持される。 |
| C-07 | **予約の重ね合わせ** | 予約カードをドラッグし、**既に予約がある枠の上**にドロップする。 | ・ドロップ可能である。<br>・ドロップ後、自動的に横並び（Overlap Layout）で表示される。 |
| C-08 | **権限チェック** | 未ログイン（または権限なし）状態でドラッグを試みる。 | ・ドラッグ操作が開始できない（カードが掴めない）、または即座に元の位置に戻る。 |
| C-09 | **開発モード許可** | `AUTH_ENABLED=false` の状態でドラッグする。 | ・ドラッグ＆ドロップが許可される（開発効率化のため）。 |

### 1-3. 月表示 (Month View)
| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| C-10 | **月間表示** | ヘッダーの「月」ボタンをクリックする。 | ・カレンダーが月表示モードに切り替わる。<br>・各日付のセルに予約件数や簡易リストが表示される。 |
| C-11 | **ドラッグ禁止** | 月表示モードで予約カードをドラッグする。 | ・ドラッグ操作が無効化されており、移動できない（誤操作防止）。 |
| C-12 | **日付クリック遷移** | 月表示で特定の日付セルをクリックする。 | ・週表示に切り替わり、クリックした日を含む週が表示される。 |

---

## 2. フィルタリング・設定

### 2-1. 担当者フィルタ (Staff Filter)
| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| F-01 | **特定担当者の絞り込み** | 右上の担当者プルダウンから「スタッフA」を選択する。 | ・カレンダー上に「スタッフA」担当の予約のみが表示される。<br>・「担当なし」や「スタッフB」の予約は非表示になる。 |
| F-02 | **担当なしの絞り込み** | 担当者プルダウンから「担当なし」を選択する。 | ・担当者が割り当てられていない予約のみが表示される。 |
| F-03 | **全表示への復帰** | 担当者プルダウンから「全ての担当者」を選択する。 | ・全ての予約が再度表示される。 |

### 2-2. 表示モードの永続化 (Persistence)
| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| P-01 | **モード記憶** | 1. デフォルト（リスト）から「カレンダー」に切り替える。<br>2. ブラウザをリロードする。 | ・初期表示が「カレンダー」モードで開く。<br>・リストに戻ってリロードすれば「リスト」で開く。 |
| P-02 | **週/月表示記憶** | 週表示から月表示に切り替え、リロードする。 | ・（任意実装）表示モード（週/月）も記憶される。 |

---

## 3. 予約詳細・モーダル

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| D-01 | **メモの表示** | `WeekView` でメモが入力された予約を確認する。 | ・カード内にメモの一部（省略表示）が表示されている。<br>・ホバー時に全文が表示される。 |
| D-02 | **詳細モーダル** | 予約カードをクリックする。 | ・予約詳細モーダルが開く。<br>・患者情報、予約日時、メモ、担当者が正しくロードされている。 |
| D-03 | **編集への導線** | 詳細モーダルから「編集」ボタンをクリックする。 | ・編集モーダルまたは編集画面に遷移する。 |

---

## 4. 新規予約作成（カレンダーから）

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| N-01 | **空き枠クリック** | 週表示で予約のない時間枠をクリックする。 | ・新規予約作成モーダルが開く。<br>・クリックした日時がプリフィルされている。 |
| N-02 | **日付維持** | 空き枠から作成モーダルを開き、患者を選択して保存する。 | ・選択した日時に予約が作成される。<br>・カレンダー上に即座に反映される。 |

---

## 5. URL連携

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| U-01 | **日付パラメータ** | URL `/appointments?date=2026-01-20` でアクセスする。 | ・指定した日付を含む週がカレンダーに表示される。 |
| U-02 | **ナビゲーション連携** | カレンダーで週を移動した際、URLを確認する。 | ・URLに現在表示中の日付が反映される（オプション）。 |

---

## ✅ テスト実施記録

| ID | 結果 | 実施日時 | 実施者 | 備考 |
|:---|:---:|:---|:---|:---|
| C-01 | ✅ | 2025-12-15 12:00 | System | Browser Automation |
| C-02 | ⬜ | - | - | - |
| C-03 | ⬜ | - | - | - |
| C-04 | ⬜ | - | - | - |
| C-05 | ⬜ | - | - | - |
| C-06 | ❌ | 2025-12-15 12:45 | System | Browser Automation Failed (Manual check needed) |
| C-07 | ⬜ | - | - | - |
| C-08 | ⬜ | - | - | - |
| C-09 | ⬜ | - | - | - |
| C-10 | ⬜ | - | - | - |
| C-11 | ⬜ | - | - | - |
| C-12 | ⬜ | - | - | - |
| F-01 | ⬜ | - | - | - |
| F-02 | ⬜ | - | - | - |
| F-03 | ⬜ | - | - | - |
| P-01 | ⬜ | - | - | - |
| P-02 | ⬜ | - | - | - |
| D-01 | ⬜ | - | - | - |
| D-02 | ⬜ | - | - | - |
| D-03 | ⬜ | - | - | - |
| N-01 | ⬜ | - | - | - |
| N-02 | ⬜ | - | - | - |
| U-01 | ⬜ | - | - | - |
| U-02 | ⬜ | - | - | - |

**凡例**: ✅ = 通過 / ❌ = 失敗 / ⬜ = 未実施

