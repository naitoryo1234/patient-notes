# 🧪 動作確認手順書: 顧客管理 (Patient Management)

## 📌 概要
本ドキュメントは、顧客（患者）管理機能の動作確認手順と期待される挙動を定義します。

---

## 1. 患者登録 (Create)

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| PT-01 | **新規登録画面** | ヘッダーまたは患者検索パネルの「新規登録」ボタンをクリックする。 | ・新規登録ページ（`/patients/new`）に遷移する。<br>・空のフォームが表示される。 |
| PT-02 | **必須項目確認** | 名前・フリガナを空欄のまま保存ボタンをクリックする。 | ・バリデーションエラーが表示される。<br>・保存が行われない。 |
| PT-03 | **正常登録** | 名前「山田 太郎」、フリガナ「ヤマダ タロウ」、電話番号を入力して保存。 | ・保存成功メッセージまたは詳細ページへ遷移。<br>・診察券番号が自動採番される。<br>・DBに正しく保存されている。 |
| PT-04 | **タグ入力** | タグ入力欄に「VIP」「定期」などを入力する。 | ・タグがJSON配列として保存される。<br>・詳細ページでタグが表示される。 |

---

## 2. 患者情報編集 (Update)

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| PT-05 | **編集画面遷移** | 患者詳細ページの「編集」ボタンをクリックする。 | ・編集ページに遷移する。<br>・既存データがフォームにプリフィルされている。 |
| PT-06 | **情報更新** | 電話番号を変更して保存する。 | ・更新成功メッセージが表示される。<br>・詳細ページに反映されている。 |
| PT-07 | **メモ（ラポート）** | メモ欄に「お子さんが二人いる」と入力して保存。 | ・メモが保存され、詳細ページで確認できる。 |

---

## 3. 患者詳細表示 (Profile)

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| PT-08 | **基本情報表示** | 患者詳細ページ（`/patients/[id]`）にアクセスする。 | ・名前、フリガナ、診察券番号、電話番号、メモが表示される。 |
| PT-09 | **記録一覧表示** | 患者に過去の記録（ClinicalRecord）が存在する場合。 | ・記録一覧が時系列順で表示される。<br>・各記録の概要（日付、主訴の冒頭など）が見える。 |
| PT-10 | **予約履歴表示** | 患者に予約履歴が存在する場合。 | ・過去・今後の予約が一覧表示される。 |
| PT-11 | **次回予約カード** | 患者に今後の予約が存在する場合。 | ・次回予約情報がカード形式で強調表示される。 |
| PT-12 | **長い名前の表示** | 名前・フリガナが非常に長い患者（例：20文字以上）を表示する。 | ・レイアウトが崩れない。<br>・必要に応じて折り返しまたは省略される。 |

---

## 4. 患者検索・フィルタ

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| PT-13 | **ひらがな/カタカナ互換** | 検索ボックスに「やまだ」（ひらがな）と入力する。 | ・フリガナが「ヤマダ」（カタカナ）の患者もヒットする。 |
| PT-14 | **検索結果数** | 大量の患者（例：100名以上）が存在する状態で検索する。 | ・パフォーマンスが維持される（3秒以内に結果表示）。 |

---

## 5. 患者削除制限 (Restrict)

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| PT-15 | **削除不可確認** | 予約または記録が紐づいている患者を削除しようとする。 | ・削除がブロックされる。<br>・「関連データがあるため削除できません」等のエラーメッセージが表示される。 |
| PT-16 | **論理削除** | （将来機能）削除実行時の挙動を確認する。 | ・物理削除ではなく `deletedAt` にタイムスタンプが設定される（論理削除）。 |

---

## 6. 予約作成への連携

| ID | 項目 | 手順 / 条件 | 期待される挙動 |
|:---|:---|:---|:---|
| PT-17 | **予約追加ボタン** | 患者詳細ページの「予約追加」ボタンをクリックする。 | ・予約作成モーダルが開く。<br>・患者が事前選択された状態になっている。 |

---

## ✅ テスト実施記録

| ID | 結果 | 実施日時 | 実施者 | 備考 |
|:---|:---:|:---|:---|:---|
| PT-01 | ⬜ | - | - | - |
| PT-02 | ⬜ | - | - | - |
| PT-03 | ⬜ | - | - | - |
| PT-04 | ⬜ | - | - | - |
| PT-05 | ⬜ | - | - | - |
| PT-06 | ⬜ | - | - | - |
| PT-07 | ⬜ | - | - | - |
| PT-08 | ⬜ | - | - | - |
| PT-09 | ⬜ | - | - | - |
| PT-10 | ⬜ | - | - | - |
| PT-11 | ⬜ | - | - | - |
| PT-12 | ⬜ | - | - | - |
| PT-13 | ⬜ | - | - | - |
| PT-14 | ⬜ | - | - | - |
| PT-15 | ⬜ | - | - | - |
| PT-16 | ⬜ | - | - | - |
| PT-17 | ⬜ | - | - | - |

**凡例**: ✅ = 通過 / ❌ = 失敗 / ⬜ = 未実施

